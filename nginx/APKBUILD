# Contributor: BARON David <db@crea.mn>
# Maintainer: BARON David <db@crea.mn>
# http://nginx.org/download
pkgname=_nginx
pkgver=1.13.5
pkgrel=1
pkgdesc="Nginx last version and its Prometheus Exporter"
url="http://www.nginx.org"
arch="x86_64"
license="GPLv2"
depends=""
depends_dev="git libressl-dev pcre-dev zlib-dev"
makedepends="$depends_dev"
install=""
subpackages=""
builddir="$srcdir/nginx-$pkgver"

prepare() {
	cd "$srcdir"
	git clone -q -b v0.1.15 https://github.com/vozlt/nginx-module-vts.git
	curl -Ls http://nginx.org/download/nginx-1.13.5.tar.gz | tar -xzf -
}

build() {
	cd "$builddir"
	./configure \
		--prefix=/usr \
		--conf-path=/etc/nginx/nginx.conf \
		--pid-path=/var/run/ \
		--error-log-path=/var/log/httpd/nginx/ \
		--http-log-path=/var/log/httpd/nginx/ \
		--with-http_v2_module \
		--add-module=../nginx-module-vts/ \
		--with-http_ssl_module
	make -j16
}

check() {
	cd "$builddir"
}

dev() {
	cd "$builddir"
}

doc() {
	cd "$builddir"
}

package() {
	cd "$builddir"
	DESTDIR=$pkgdir/ make install
}

